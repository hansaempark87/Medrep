<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MedRep Intelligence - AI 기반 제약 영업 인텔리전스</title>
<meta name="description" content="AI 기반 제약 영업 인텔리전스 - KOL 분석, 접근 전략"/>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css" rel="stylesheet"/>
<script>
tailwind.config={theme:{extend:{colors:{primary:{50:'#e8f0f8',100:'#c5d9ed',200:'#9ebfe0',300:'#77a5d3',400:'#5991c9',500:'#3b7dbf',600:'#2f6ba8',700:'#1f5a91',800:'#0F4C81',900:'#0a3a64',950:'#062848'},accent:{50:'#fff7ed',100:'#ffedd5',500:'#f97316',600:'#ea580c'},success:{50:'#ecfdf5',100:'#d1fae5',500:'#10b981',600:'#059669'},danger:{50:'#fef2f2',100:'#fee2e2',500:'#ef4444',600:'#dc2626'},surface:{50:'#f8fafc',100:'#f1f5f9',200:'#e2e8f0',300:'#cbd5e1'}},fontFamily:{sans:['Inter','Noto Sans KR','system-ui','sans-serif']}}}}
</script>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter','Noto Sans KR',system-ui,sans-serif;background:#f0f4f8}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:#f1f5f9}::-webkit-scrollbar-thumb{background:#94a3b8;border-radius:3px}
@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse-glow{0%,100%{box-shadow:0 0 0 0 rgba(15,76,129,0.2)}50%{box-shadow:0 0 0 8px rgba(15,76,129,0)}}
@keyframes progressStep{from{width:0}to{width:100%}}
.animate-fadeInUp{animation:fadeInUp .5s ease-out forwards}.pulse-glow{animation:pulse-glow 2s infinite}
.stat-card:hover{transform:translateY(-4px);box-shadow:0 12px 40px rgba(15,76,129,0.15)}
.nav-item:hover{background:rgba(255,255,255,0.1)}.nav-item.active{background:rgba(255,255,255,0.15);border-left:3px solid #60a5fa}
.kol-card:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,0.1)}
.progress-animate{animation:progressStep 15s linear forwards}
.section-card{background:white;border-radius:1rem;padding:1.25rem;box-shadow:0 1px 3px rgba(0,0,0,0.05);border:1px solid #e2e8f0}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useCallback}=React;

// ============================================================
// MOCK DATA (Dashboard)
// ============================================================
const monthlyData=[{month:"1월",count:15},{month:"2월",count:18},{month:"3월",count:22},{month:"4월",count:19},{month:"5월",count:25},{month:"6월",count:28},{month:"7월",count:31},{month:"8월",count:27},{month:"9월",count:35},{month:"10월",count:38},{month:"11월",count:42},{month:"12월",count:47}];
const upcomingSchedules=[{title:"삼성서울병원 P&T",date:"2024.01.15",dday:3,type:"critical",desc:"신약 등재 심의"},{title:"서울대병원 약제부",date:"2024.01.18",dday:6,type:"normal",desc:"분기별 약품 리뷰"},{title:"분당서울대 약사위",date:"2024.01.22",dday:10,type:"normal",desc:"약가 협상 사전 미팅"},{title:"KDA 동계학술대회",date:"2024.01.25",dday:13,type:"conference",desc:"부스+심포지엄"}];
const teamMembers=[{name:"김영업",role:"수도권1팀",status:"active",kols:12,target:85},{name:"이약품",role:"수도권2팀",status:"active",kols:9,target:78},{name:"박제약",role:"경인지역",status:"active",kols:11,target:92},{name:"최마케",role:"충청지역",status:"inactive",kols:7,target:65},{name:"정학술",role:"MSL",status:"active",kols:15,target:88},{name:"한영업",role:"수도권3팀",status:"active",kols:10,target:82}];
const ptDatabase={hospitals:[{name:"삼성서울병원",committee:"약사위원회 (P&T)",nextMeeting:"2024.01.15",dday:3,members:[{name:"김약제 부장",role:"위원장",influence:"최고",stance:"중립",note:"근거 중심. 메타분석 자료 필수"},{name:"정내과 교수",role:"내과 대표",influence:"높음",stance:"우호적",note:"임상경험 긍정적"},{name:"이외과 교수",role:"외과 대표",influence:"보통",stance:"중립",note:"비용 효과성 관심"},{name:"박약사",role:"임상약사",influence:"높음",stance:"부정적",note:"약가 우려. 약경제학 자료 필요"}],strategy:["가이드라인 반영 현황 1p 요약","처방 경험 사례 활용","약물경제학(ICER) 자료 준비","D-2 약제부 자료 전달"],documents:[{name:"PI Summary",status:"완료",icon:"fa-file-medical"},{name:"임상시험 데이터",status:"완료",icon:"fa-chart-bar"},{name:"약물경제학 분석",status:"진행중",icon:"fa-calculator"},{name:"가이드라인 비교표",status:"완료",icon:"fa-globe"}]},{name:"서울아산병원",committee:"신약심의위원회",nextMeeting:"2024.02.05",dday:24,members:[{name:"최약제 부장",role:"약제부장",influence:"최고",stance:"중립",note:"RCT+RWD 모두 중시"},{name:"이종양 교수",role:"종양내과",influence:"높음",stance:"우호적",note:"임상시험 경험"}],strategy:["리얼월드 데이터 제시","유사 약제 처방 현황 분석"],documents:[{name:"제품 요약",status:"진행중",icon:"fa-file-medical"},{name:"임상 패키지",status:"진행중",icon:"fa-chart-bar"}]}]};

// ============================================================
// SIDEBAR / HEADER
// ============================================================
function Sidebar({currentPage,setCurrentPage,sidebarOpen,setSidebarOpen}){
  const nav=[{id:'dashboard',icon:'fa-chart-line',label:'대시보드'},{id:'kol',icon:'fa-user-doctor',label:'KOL 인텔리전스',badge:'AI'},{id:'koldb',icon:'fa-database',label:'KOL 데이터베이스'},{id:'pnt',icon:'fa-hospital',label:'P&T 전략',badge:'2'},{id:'pricing',icon:'fa-credit-card',label:'구독 플랜'}];
  return(<>{sidebarOpen&&<div className="fixed inset-0 bg-black/50 z-40 lg:hidden" onClick={()=>setSidebarOpen(false)}/>}
  <div className={`fixed left-0 top-0 h-full w-64 bg-gradient-to-b from-primary-800 via-primary-900 to-primary-950 text-white flex flex-col z-50 shadow-2xl transition-transform duration-300 lg:translate-x-0 ${sidebarOpen?'translate-x-0':'-translate-x-full'}`}>
    <div className="p-5 border-b border-primary-700/50"><div className="flex items-center gap-3"><div className="w-10 h-10 bg-gradient-to-br from-blue-400 to-cyan-300 rounded-xl flex items-center justify-center shadow-lg"><i className="fas fa-brain text-primary-900 text-lg"/></div><div><h1 className="text-lg font-bold tracking-tight">MedRep<span className="text-blue-300">AI</span></h1><p className="text-[10px] text-blue-300/70 tracking-wider uppercase">Intelligence Platform v4</p></div></div></div>
    <nav className="flex-1 p-3 space-y-1 mt-2">{nav.map(it=><button key={it.id} onClick={()=>{setCurrentPage(it.id);setSidebarOpen(false)}} className={`nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition-all ${currentPage===it.id?'active bg-white/15 text-white font-semibold':'text-blue-200/80 hover:text-white'}`}><i className={`fas ${it.icon} w-5 text-center ${currentPage===it.id?'text-blue-300':''}`}/><span className="text-sm">{it.label}</span>{it.badge&&<span className={`ml-auto text-[10px] font-bold px-2 py-0.5 rounded-full ${it.badge==='AI'?'bg-gradient-to-r from-purple-500 to-pink-500 text-white':'bg-blue-500/30 text-blue-200'}`}>{it.badge}</span>}</button>)}</nav>
    <div className="p-4 border-t border-primary-700/50"><div className="flex items-center gap-3"><div className="w-9 h-9 rounded-full bg-gradient-to-br from-blue-400 to-cyan-300 flex items-center justify-center text-primary-900 font-bold text-sm">MR</div><div className="flex-1 min-w-0"><p className="text-sm font-semibold truncate">사용자</p><p className="text-[11px] text-blue-300/60">영업전략팀</p></div><div className="w-2 h-2 bg-green-400 rounded-full"/></div></div>
  </div></>);
}
function Header({currentPage,setSidebarOpen}){
  const t={dashboard:{title:'대시보드',sub:'팀 성과와 주요 지표'},kol:{title:'KOL 인텔리전스',sub:'DB 기반 KOL 프로필 + AI 실전 접근 전략'},koldb:{title:'KOL 데이터베이스',sub:'KOL 프로필 등록 및 관리 (CRUD)'},pnt:{title:'P&T 전략 플래너',sub:'병원 약사위원회 대응 전략'},pricing:{title:'구독 플랜',sub:'팀 규모에 맞는 플랜'}};
  const i=t[currentPage]||t.dashboard;
  return(<header className="bg-white/80 backdrop-blur-md border-b border-surface-200 px-4 lg:px-8 py-4 sticky top-0 z-30"><div className="flex items-center justify-between"><div className="flex items-center gap-3"><button onClick={()=>setSidebarOpen(true)} className="lg:hidden w-10 h-10 rounded-xl bg-surface-100 flex items-center justify-center text-gray-500"><i className="fas fa-bars"/></button><div><h2 className="text-lg lg:text-xl font-bold text-gray-900">{i.title}</h2><p className="text-xs lg:text-sm text-gray-500 mt-0.5">{i.sub}</p></div></div></div></header>);
}
function StatCard({icon,iconColor,bgColor,title,value,sub,subColor,delay,onClick}){return(<div onClick={onClick} className={`stat-card bg-white rounded-2xl p-5 shadow-sm border border-surface-200/60 transition-all animate-fadeInUp ${onClick?'cursor-pointer':''}`} style={{animationDelay:`${delay}ms`}}><div className={`w-11 h-11 ${bgColor} rounded-xl flex items-center justify-center`}><i className={`fas ${icon} ${iconColor} text-base`}/></div><div className="mt-3"><p className="text-xs text-gray-500 font-medium">{title}</p><p className="text-xl font-bold text-gray-900 mt-1">{value}</p><p className={`text-[11px] mt-1.5 ${subColor} font-medium flex items-center gap-1`}>{sub}</p></div></div>);}
function PerformanceChart(){const r=useRef(null),ci=useRef(null);useEffect(()=>{if(ci.current)ci.current.destroy();ci.current=new Chart(r.current.getContext('2d'),{type:'bar',data:{labels:monthlyData.map(d=>d.month),datasets:[{label:'KOL 분석',data:monthlyData.map(d=>d.count),backgroundColor:monthlyData.map((d,i)=>i===11?'#0F4C81':'rgba(15,76,129,0.45)'),borderRadius:6,borderSkipped:false,barPercentage:0.7}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,grid:{color:'rgba(0,0,0,0.04)'}},x:{grid:{display:false}}}}});return()=>{if(ci.current)ci.current.destroy()}},[]);return <canvas ref={r}/>;}

// ============================================================
// DASHBOARD
// ============================================================
function Dashboard({onNavigateToKOL}){return(<div className="space-y-5"><div className="grid grid-cols-1 sm:grid-cols-3 gap-4"><StatCard icon="fa-user-doctor" iconColor="text-primary-600" bgColor="bg-primary-50" title="이번 달 KOL 분석" value="47명" sub={<><i className="fas fa-arrow-up text-[10px]"/> 전월 대비 23%</>} subColor="text-success-600" delay={0}/><StatCard icon="fa-users" iconColor="text-accent-600" bgColor="bg-accent-50" title="팀 활동 현황" value="12/15명" sub={<><i className="fas fa-circle text-[8px] text-green-400"/> 활성 80%</>} subColor="text-gray-500" delay={100}/><StatCard icon="fa-calendar-check" iconColor="text-danger-500" bgColor="bg-danger-50" title="다가오는 일정" value="삼성서울병원 P&T" sub={<span className="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-100 text-red-600 font-bold text-[11px] pulse-glow"><i className="fas fa-exclamation-circle text-[9px]"/>D-3</span>} subColor="text-danger-600" delay={200}/></div>
  <div className="grid grid-cols-1 lg:grid-cols-3 gap-4"><div className="lg:col-span-2 bg-white rounded-2xl p-5 shadow-sm border border-surface-200/60 animate-fadeInUp" style={{animationDelay:'300ms'}}><div className="flex items-center justify-between mb-4"><div><h3 className="font-bold text-gray-900 text-sm">2024년 팀 성과</h3><p className="text-[11px] text-gray-400">월별 KOL 분석 추이</p></div></div><div style={{height:'240px'}}><PerformanceChart/></div></div>
  <div className="bg-white rounded-2xl p-5 shadow-sm border border-surface-200/60 animate-fadeInUp" style={{animationDelay:'400ms'}}><h3 className="font-bold text-gray-900 mb-3 flex items-center gap-2 text-sm"><i className="fas fa-calendar-alt text-primary-500"/>일정</h3><div className="space-y-2">{upcomingSchedules.map((s,i)=><div key={i} className={`p-3 rounded-xl border-l-4 ${s.type==='critical'?'border-red-500 bg-red-50/50':s.type==='conference'?'border-purple-500 bg-purple-50/50':'border-primary-300 bg-primary-50/30'}`}><div className="flex items-center justify-between"><span className="text-xs font-semibold text-gray-800">{s.title}</span><span className={`text-[10px] font-bold px-2 py-0.5 rounded-full ${s.dday<=5?'bg-red-100 text-red-600':'bg-gray-100 text-gray-500'}`}>D-{s.dday}</span></div><p className="text-[10px] text-gray-400 mt-0.5">{s.desc}</p></div>)}</div></div></div>
  <div className="bg-white rounded-2xl p-5 shadow-sm border border-surface-200/60 animate-fadeInUp" style={{animationDelay:'500ms'}}><h3 className="font-bold text-gray-900 mb-3 flex items-center gap-2 text-sm"><i className="fas fa-users text-primary-500"/> 팀원 현황</h3><div className="grid grid-cols-2 md:grid-cols-3 gap-3">{teamMembers.map((m,i)=><div key={i} className="flex items-center gap-2 p-2 rounded-lg hover:bg-surface-50"><div className={`w-2 h-2 rounded-full ${m.status==='active'?'bg-green-400':'bg-gray-300'}`}/><div className="flex-1"><div className="flex items-center justify-between"><span className="text-sm font-medium text-gray-800">{m.name}</span><span className="text-[10px] text-gray-400">{m.kols}건</span></div><div className="flex items-center gap-2 mt-1"><div className="flex-1 h-1.5 bg-surface-100 rounded-full overflow-hidden"><div className={`h-full rounded-full ${m.target>=85?'bg-green-400':m.target>=70?'bg-blue-400':'bg-orange-400'}`} style={{width:`${m.target}%`}}/></div><span className="text-[10px] text-gray-400">{m.target}%</span></div></div></div>)}</div></div></div>);}

// ============================================================
// KOL INTELLIGENCE v4.0 — 간략 + 실전 중심
// ============================================================

// 진료일정 그리드
function ScheduleGrid({schedule}){
  if(!schedule)return null;
  const days=['mon','tue','wed','thu','fri'];
  const labels=['월','화','수','목','금'];
  return(<div>
    <h4 className="text-xs font-bold text-gray-700 mb-2 flex items-center gap-1.5"><i className="fas fa-calendar-days text-primary-500"/>주간 진료 일정</h4>
    <div className="grid grid-cols-5 gap-1.5 mb-2">{days.map((d,i)=>{const am=schedule[`${d}_am`];const pm=schedule[`${d}_pm`];return(<div key={d} className="text-center"><p className="text-[10px] font-bold text-gray-500 mb-1">{labels[i]}</p><div className={`rounded-lg py-1 text-[10px] font-medium mb-0.5 ${am?'bg-primary-50 text-primary-700 border border-primary-200':'bg-gray-50 text-gray-300'}`}>{am||'—'}</div><div className={`rounded-lg py-1 text-[10px] font-medium ${pm?'bg-blue-50 text-blue-700 border border-blue-200':'bg-gray-50 text-gray-300'}`}>{pm||'—'}</div></div>)})}</div>
    {schedule.note&&<p className="text-[11px] text-amber-700 bg-amber-50 px-2.5 py-1.5 rounded-lg border border-amber-200"><i className="fas fa-info-circle text-amber-500 mr-1"/>{schedule.note}</p>}
  </div>);
}

// 치료 성향 요약
function TreatmentSummary({philosophy, preferences}){
  if(!philosophy&&(!preferences||!preferences.length))return null;
  return(<div>
    <h4 className="text-xs font-bold text-gray-700 mb-2 flex items-center gap-1.5"><i className="fas fa-stethoscope text-green-500"/>치료 성향</h4>
    {philosophy&&<p className="text-xs text-gray-600 leading-relaxed mb-3 bg-green-50 p-3 rounded-lg border border-green-100">{philosophy}</p>}
    {preferences?.length>0&&<div className="space-y-2">{preferences.map((p,i)=><div key={i} className="border border-surface-200 rounded-lg p-3 hover:border-green-200 transition-all"><div className="flex items-center gap-2 mb-1"><span className="text-[10px] font-bold px-2 py-0.5 rounded-full bg-green-50 text-green-700 border border-green-200">{p.category}</span><span className="text-[10px] text-gray-500 font-medium">{p.preference}</span></div><p className="text-[11px] text-gray-600 leading-relaxed">{p.detail}</p></div>)}</div>}
  </div>);
}

// 연구/학술 요약
function ResearchSummary({researchFocus, publications, societyRoles, booksPatents}){
  const hasContent=researchFocus||(publications?.length>0)||(societyRoles?.length>0)||(booksPatents?.length>0);
  if(!hasContent)return null;
  return(<div>
    <h4 className="text-xs font-bold text-gray-700 mb-2 flex items-center gap-1.5"><i className="fas fa-microscope text-purple-500"/>연구 & 학술</h4>
    {researchFocus&&<p className="text-xs text-purple-800 leading-relaxed mb-3 bg-purple-50 p-3 rounded-lg border border-purple-100">{researchFocus}</p>}
    {publications?.length>0&&<div className="mb-3"><p className="text-[10px] font-bold text-gray-500 mb-1.5">주요 논문</p><div className="space-y-1.5">{publications.map((p,i)=><div key={i} className="text-[11px] border-l-2 border-primary-300 pl-2.5 py-0.5"><span className="text-gray-400">({p.year})</span> <span className="text-gray-700">{p.title}</span> <span className="text-blue-500">[{p.journal}]</span>{p.note&&<p className="text-[10px] text-gray-400 italic mt-0.5">→ {p.note}</p>}</div>)}</div></div>}
    {booksPatents?.length>0&&<div className="mb-3"><p className="text-[10px] font-bold text-gray-500 mb-1.5">저서/가이드라인</p><div className="flex flex-wrap gap-1.5">{booksPatents.map((b,i)=><span key={i} className="text-[10px] px-2 py-0.5 rounded bg-surface-50 border border-surface-200 text-gray-600">({b.year}) {b.title}</span>)}</div></div>}
    {societyRoles?.length>0&&<div><p className="text-[10px] font-bold text-gray-500 mb-1.5">학회 직책</p><div className="grid grid-cols-1 gap-1">{societyRoles.map((r,i)=><p key={i} className="text-[11px] text-gray-600"><span className="text-gray-400">({r.year})</span> {r.society} <span className="text-primary-600 font-medium">{r.role}</span></p>)}</div></div>}
  </div>);
}

// 미디어/강연 요약
function MediaSummary({media, sourceUrls}){
  if((!media||!media.length)&&(!sourceUrls||!sourceUrls.length))return null;
  return(<div>
    <h4 className="text-xs font-bold text-gray-700 mb-2 flex items-center gap-1.5"><i className="fas fa-video text-red-500"/>미디어 & 강연</h4>
    {media?.map((m,i)=><div key={i} className="mb-3 last:mb-0 border border-surface-200 rounded-lg p-3 hover:border-red-200 transition-all">
      <div className="flex items-center gap-2 mb-1.5"><span className={`text-[9px] px-1.5 py-0.5 rounded font-bold ${m.type==='YouTube'?'bg-red-100 text-red-600':'bg-blue-100 text-blue-600'}`}><i className={`fab ${m.type==='YouTube'?'fa-youtube':'fa-globe'} mr-0.5`}/>{m.type}</span><a href={m.url} target="_blank" rel="noopener noreferrer" className="text-[11px] text-gray-800 font-medium hover:text-primary-600 truncate">{m.title}</a></div>
      {m.key_points?.length>0&&<ul className="space-y-0.5">{m.key_points.map((kp,j)=><li key={j} className="text-[11px] text-gray-600 flex items-start gap-1.5"><i className="fas fa-check-circle text-green-400 mt-0.5 flex-shrink-0 text-[9px]"/><span>{kp}</span></li>)}</ul>}
    </div>)}
    {sourceUrls?.length>0&&<div className="mt-2 pt-2 border-t border-surface-200"><p className="text-[10px] text-gray-400 mb-1"><i className="fas fa-link mr-1"/>출처</p><div className="flex flex-wrap gap-1.5">{sourceUrls.map((u,i)=><a key={i} href={u} target="_blank" rel="noopener noreferrer" className="text-[10px] px-2 py-0.5 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-100 truncate max-w-[220px]"><i className="fas fa-external-link-alt mr-0.5"/>{u.replace(/https?:\/\//,'').substring(0,30)}...</a>)}</div></div>}
  </div>);
}

// AI 접근 전략 섹션 (v4: 더 구체적, 실행 가능)
function AIStrategy({strategy, isDB}){
  if(!strategy)return null;
  return(<div className="space-y-4">
    {/* 한 마디 요약 */}
    {strategy.oneLiner&&<div className="bg-gradient-to-r from-primary-800 to-primary-600 rounded-xl p-4 text-white"><p className="text-[10px] font-medium text-blue-200 mb-1"><i className="fas fa-bullseye mr-1"/>한 마디 정의</p><p className="text-sm font-bold">{strategy.oneLiner}</p></div>}

    {/* 핵심 접근 전략 */}
    {strategy.approachStrategy&&<div className="bg-purple-50 rounded-xl p-4 border border-purple-200"><p className="text-[10px] font-bold text-purple-600 mb-1"><i className="fas fa-chess mr-1"/>핵심 접근 전략</p><p className="text-xs text-purple-800 leading-relaxed">{strategy.approachStrategy}</p></div>}

    {/* 핵심 인사이트 */}
    {strategy.keyInsights?.length>0&&<div className="bg-blue-50 rounded-xl p-4 border border-blue-200"><p className="text-[10px] font-bold text-blue-600 mb-2"><i className="fas fa-lightbulb mr-1"/>영업 담당자가 알아야 할 핵심</p><ul className="space-y-1.5">{strategy.keyInsights.map((k,i)=><li key={i} className="text-xs text-blue-800 flex items-start gap-2"><span className="w-5 h-5 rounded-full bg-blue-200 text-blue-700 flex items-center justify-center flex-shrink-0 text-[10px] font-bold">{i+1}</span>{k}</li>)}</ul></div>}

    {/* 액션 아이템 */}
    {strategy.actionItems?.length>0&&<div><p className="text-xs font-bold text-gray-700 mb-2"><i className="fas fa-tasks text-primary-500 mr-1"/>실행 가이드</p><div className="grid grid-cols-1 md:grid-cols-2 gap-3">{strategy.actionItems.map((a,i)=><div key={i} className="border border-surface-200 rounded-xl p-3.5 hover:border-primary-200 hover:shadow-sm transition-all"><div className="flex items-start gap-2.5"><div className="w-8 h-8 rounded-lg bg-primary-50 text-primary-500 flex items-center justify-center flex-shrink-0"><i className={`fas ${a.icon||'fa-lightbulb'} text-sm`}/></div><div><h5 className="text-xs font-bold text-gray-900">{a.title}</h5><p className="text-[11px] text-gray-600 mt-0.5 leading-relaxed">{a.text}</p></div></div></div>)}</div></div>}

    {/* 대화 포인트 */}
    {strategy.talkingPoints?.length>0&&<div className="bg-surface-50 rounded-xl p-4 border border-surface-200"><p className="text-[10px] font-bold text-gray-600 mb-2"><i className="fas fa-comments mr-1"/>미팅 시 대화 포인트</p><ul className="space-y-1">{strategy.talkingPoints.map((t,i)=><li key={i} className="text-xs text-gray-700 flex items-start gap-2"><i className="fas fa-comment-dots text-primary-400 mt-0.5 text-[10px]"/>{t}</li>)}</ul></div>}

    {/* Do / Don't */}
    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
      {strategy.doList?.length>0&&<div className="bg-green-50 rounded-xl p-4 border border-green-200"><p className="text-[10px] font-bold text-green-700 mb-2"><i className="fas fa-circle-check mr-1"/>이렇게 하세요</p><ul className="space-y-1">{strategy.doList.map((d,i)=><li key={i} className="text-[11px] text-green-700 flex items-start gap-1.5"><i className="fas fa-check text-green-500 mt-0.5 text-[9px]"/>{d}</li>)}</ul></div>}
      {strategy.dontList?.length>0&&<div className="bg-red-50 rounded-xl p-4 border border-red-200"><p className="text-[10px] font-bold text-red-700 mb-2"><i className="fas fa-circle-xmark mr-1"/>이것은 피하세요</p><ul className="space-y-1">{strategy.dontList.map((d,i)=><li key={i} className="text-[11px] text-red-700 flex items-start gap-1.5"><i className="fas fa-xmark text-red-400 mt-0.5 text-[9px]"/>{d}</li>)}</ul></div>}
    </div>

    {/* 방문 전 체크리스트 */}
    {strategy.preparationChecklist?.length>0&&<div className="bg-amber-50 rounded-xl p-4 border border-amber-200"><p className="text-[10px] font-bold text-amber-700 mb-2"><i className="fas fa-clipboard-check mr-1"/>방문 전 준비 체크리스트</p><ul className="space-y-1">{strategy.preparationChecklist.map((c,i)=><li key={i} className="text-[11px] text-amber-800 flex items-start gap-2"><input type="checkbox" className="mt-0.5 accent-amber-600"/><span>{c}</span></li>)}</ul></div>}
  </div>);
}

function KOLIntelligence({initialQuery}){
  const [sq,setSq]=useState(initialQuery||'');
  const [data,setData]=useState(null);
  const [aiStrategy,setAiStrategy]=useState(null);
  const [source,setSource]=useState(null);
  const [loading,setLoading]=useState(false);
  const [error,setError]=useState(null);
  const [steps,setSteps]=useState([]);
  const [activeSection,setActiveSection]=useState('overview');
  const autoRef=useRef(false);

  useEffect(()=>{if(initialQuery&&initialQuery.trim().length>=2&&!autoRef.current){autoRef.current=true;doSearch(initialQuery)}},[initialQuery]);

  const doSearch=async(q)=>{
    const v=(q||sq).trim();if(!v||v.length<2)return;
    setSq(v);setLoading(true);setData(null);setAiStrategy(null);setError(null);setSource(null);setSteps([]);setActiveSection('overview');
    const ss=[{t:'DB 검색 중...',d:0},{t:'프로필 데이터 매칭...',d:1200},{t:'AI 접근 전략 생성 중...',d:3000},{t:'리포트 완성...',d:6000}];
    ss.forEach(s=>setTimeout(()=>setSteps(p=>[...p,s.t]),s.d));
    try{
      const r=await fetch('/api/kol/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query:v})});
      if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.error||`분석 실패 (${r.status})`)}
      const result=await r.json();
      if(result.success){setSource(result.source);setData(result.data);if(result.aiStrategy)setAiStrategy(result.aiStrategy)}else throw new Error('결과 없음');
    }catch(e){setError(e.message)}finally{setLoading(false)}
  };

  const qk=[{label:"정성진 교수",query:"분당서울대학교병원 비뇨의학과 정성진 교수"}];
  const isDB=source==='database';

  return(<div className="space-y-5">
    {/* Search */}
    <div className="section-card animate-fadeInUp">
      <div className="text-center mb-4"><h2 className="text-xl font-bold text-gray-900">KOL 인텔리전스</h2><p className="text-xs text-gray-400 mt-1">DB 등록 KOL → 실데이터 기반 분석 | 미등록 KOL → AI 추정 (정확도 제한)</p></div>
      <div className="max-w-2xl mx-auto"><div className="relative"><i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-300"/><input type="text" value={sq} onChange={e=>setSq(e.target.value)} onKeyDown={e=>e.key==='Enter'&&!loading&&doSearch()} placeholder="교수명 + 병원명 (예: 정성진)" disabled={loading} className="w-full pl-11 pr-24 py-3 rounded-xl border-2 border-surface-200 focus:border-primary-400 focus:ring-4 focus:ring-primary-100 outline-none text-sm disabled:opacity-50"/><button onClick={()=>doSearch()} disabled={loading} className="absolute right-2 top-1/2 -translate-y-1/2 px-4 py-2 bg-gradient-to-r from-primary-800 to-primary-600 text-white rounded-lg text-sm font-semibold disabled:opacity-50">{loading?<><i className="fas fa-spinner fa-spin mr-1"/>분석중</>:<><i className="fas fa-search mr-1"/>검색</>}</button></div>
      <div className="flex items-center gap-2 mt-2.5 justify-center"><span className="text-[10px] text-gray-400">빠른 검색:</span>{qk.map((q,i)=><button key={i} onClick={()=>{setSq(q.query);doSearch(q.query)}} disabled={loading} className="text-[11px] px-3 py-1 rounded-full border border-primary-200 text-primary-600 hover:bg-primary-50 font-medium disabled:opacity-50"><i className="fas fa-bolt text-[9px] mr-1 text-primary-400"/>{q.label}</button>)}</div></div>
    </div>

    {/* Loading */}
    {loading&&<div className="section-card animate-fadeInUp"><div className="max-w-sm mx-auto py-4"><div className="flex items-center justify-center gap-1.5 mb-3"><div className="w-2 h-2 rounded-full bg-primary-500 animate-bounce"/><div className="w-2 h-2 rounded-full bg-primary-400 animate-bounce" style={{animationDelay:'150ms'}}/><div className="w-2 h-2 rounded-full bg-primary-300 animate-bounce" style={{animationDelay:'300ms'}}/></div><h3 className="text-sm font-bold text-gray-800 text-center mb-3">분석 중</h3><div className="w-full h-1 bg-surface-100 rounded-full overflow-hidden mb-3"><div className="h-full bg-gradient-to-r from-green-500 via-primary-500 to-purple-400 rounded-full progress-animate"/></div><div className="space-y-1">{steps.map((s,i)=><div key={i} className="flex items-center gap-2 text-xs animate-fadeInUp">{i<steps.length-1?<i className="fas fa-check-circle text-green-400 w-3.5"/>:<i className="fas fa-spinner fa-spin text-primary-500 w-3.5"/>}<span className={i<steps.length-1?'text-gray-400':'text-primary-600 font-medium'}>{s}</span></div>)}</div></div></div>}

    {/* Error */}
    {error&&!loading&&<div className="bg-red-50 rounded-xl p-4 border border-red-200 animate-fadeInUp"><div className="flex items-center gap-3"><div className="w-9 h-9 rounded-lg bg-red-100 flex items-center justify-center"><i className="fas fa-exclamation-triangle text-red-500"/></div><div className="flex-1"><h4 className="font-bold text-red-800 text-sm">{error}</h4></div><button onClick={()=>doSearch()} className="px-3 py-1.5 bg-red-600 text-white rounded-lg text-xs font-medium">재시도</button></div></div>}

    {/* ===== DB RESULTS ===== */}
    {data&&!loading&&isDB&&(()=>{
      const d=data;
      const tierColors={'A':'bg-purple-100 text-purple-700 border-purple-200','B':'bg-blue-100 text-blue-700 border-blue-200','C':'bg-teal-100 text-teal-700 border-teal-200','D':'bg-gray-100 text-gray-500 border-gray-200'};
      const personaIcons={'Champion':'fa-crown text-yellow-600','Advocate':'fa-bullhorn text-blue-600','Supporter':'fa-thumbs-up text-green-600','Neutral':'fa-minus-circle text-gray-500','Non-Adopter':'fa-ban text-red-500'};
      const pIcon=personaIcons[d.persona]||personaIcons.Neutral;

      const sections=[
        {id:'overview',icon:'fa-id-card',label:'요약'},
        {id:'treatment',icon:'fa-stethoscope',label:'치료 성향'},
        {id:'research',icon:'fa-microscope',label:'연구·학술'},
        {id:'media',icon:'fa-video',label:'미디어'},
        {id:'strategy',icon:'fa-chess',label:'접근 전략'}
      ];

      return(<div className="space-y-4 animate-fadeInUp">
        {/* Source badge */}
        <div className="flex items-center justify-center"><span className="inline-flex items-center gap-1.5 px-3 py-1 bg-green-50 border border-green-200 rounded-full"><i className="fas fa-database text-green-500 text-[10px]"/><span className="text-[10px] font-bold text-green-600">DB 등록 데이터</span>{aiStrategy&&<><span className="text-[10px] text-gray-300">+</span><i className="fas fa-wand-magic-sparkles text-purple-500 text-[10px]"/><span className="text-[10px] font-bold text-purple-600">AI 전략</span></>}</span></div>

        {/* Profile Card */}
        <div className="section-card overflow-hidden">
          <div className="flex items-start gap-4">
            <div className="w-14 h-14 rounded-xl bg-gradient-to-br from-green-500 to-cyan-400 flex items-center justify-center text-white text-xl font-bold flex-shrink-0 shadow-lg">{d.name?.slice(-1)||'?'}</div>
            <div className="flex-1 min-w-0">
              <div className="flex items-center gap-2 flex-wrap">
                <h2 className="text-lg font-bold text-gray-900">{d.name}</h2>
                <span className="text-xs text-gray-400">{d.position}</span>
                <span className={`text-[10px] px-2 py-0.5 rounded-full font-bold border ${tierColors[d.kolTier]||tierColors.C}`}>Tier {d.kolTier}</span>
                <span className="text-[10px] px-2 py-0.5 rounded-full bg-surface-50 text-gray-500 border border-surface-200"><i className={`fas ${pIcon} mr-0.5`}/>{d.persona}</span>
              </div>
              <p className="text-xs text-gray-500 mt-1">{d.hospital} | {d.specialty}</p>
              {d.specialtyTags?.length>0&&<div className="flex flex-wrap gap-1 mt-2">{d.specialtyTags.map((t,i)=><span key={i} className="text-[10px] px-2 py-0.5 rounded-full bg-primary-50 text-primary-600">{t}</span>)}</div>}
            </div>
          </div>
          {/* Quick stats */}
          <div className="grid grid-cols-4 gap-2 mt-4 pt-3 border-t border-surface-100">
            <div className="text-center"><p className="text-lg font-bold text-primary-800">{d.publications}</p><p className="text-[9px] text-gray-400">논문</p></div>
            <div className="text-center"><p className="text-lg font-bold text-primary-800">{d.hIndex}</p><p className="text-[9px] text-gray-400">H-Index</p></div>
            <div className="text-center"><p className="text-lg font-bold text-primary-800">{d.clinicalTrials}</p><p className="text-[9px] text-gray-400">임상시험</p></div>
            <div className="text-center"><p className="text-xs font-bold text-primary-800">{d.prescriptionPattern}</p><p className="text-[9px] text-gray-400">처방 패턴</p></div>
          </div>
        </div>

        {/* Section Tabs */}
        <div className="flex gap-1 bg-white rounded-xl p-1 shadow-sm border border-surface-200/60 overflow-x-auto">{sections.map(s=><button key={s.id} onClick={()=>setActiveSection(s.id)} className={`flex-1 flex items-center justify-center gap-1 py-2 rounded-lg text-[11px] font-medium transition-all whitespace-nowrap ${activeSection===s.id?'bg-primary-800 text-white shadow':'text-gray-500 hover:bg-surface-50'}`}><i className={`fas ${s.icon} text-[9px]`}/>{s.label}</button>)}</div>

        {/* Section Content */}
        <div className="section-card">
          {activeSection==='overview'&&<div className="space-y-5">
            <ScheduleGrid schedule={d.clinicSchedule}/>
            {/* 학력/경력 요약 */}
            {(d.education?.length>0||d.career?.length>0)&&<div>
              <h4 className="text-xs font-bold text-gray-700 mb-2 flex items-center gap-1.5"><i className="fas fa-graduation-cap text-blue-500"/>학력 & 경력</h4>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                {d.education?.length>0&&<div><p className="text-[10px] font-bold text-gray-500 mb-1">학력</p>{d.education.map((e,i)=><p key={i} className="text-[11px] text-gray-700 mb-0.5">{e.year} {e.school} <span className="text-gray-400">{e.degree}</span></p>)}</div>}
                {d.career?.length>0&&<div><p className="text-[10px] font-bold text-gray-500 mb-1">최근 경력</p>{d.career.slice(-4).reverse().map((c,i)=><p key={i} className="text-[11px] text-gray-700 mb-0.5">{c.period} <span className="text-primary-600 font-medium">{c.role}</span><span className="text-gray-400"> ({c.institution})</span></p>)}</div>}
              </div>
            </div>}
            {/* 수상 */}
            {d.awards?.length>0&&<div>
              <h4 className="text-xs font-bold text-gray-700 mb-1.5 flex items-center gap-1.5"><i className="fas fa-trophy text-amber-500"/>주요 수상 ({d.awards.length}건)</h4>
              <div className="flex flex-wrap gap-1">{d.awards.slice(0,5).map((a,i)=><span key={i} className="text-[10px] px-2 py-0.5 rounded bg-amber-50 text-amber-700 border border-amber-200">({a.year}) {a.title}</span>)}{d.awards.length>5&&<span className="text-[10px] text-gray-400 self-center">외 {d.awards.length-5}건</span>}</div>
            </div>}
            {/* 전략 메모 */}
            {d.strategyMemo&&<div>
              <h4 className="text-xs font-bold text-gray-700 mb-1.5 flex items-center gap-1.5"><i className="fas fa-clipboard text-primary-500"/>영업 전략 메모</h4>
              <p className="text-xs text-gray-600 leading-relaxed bg-primary-50 p-3 rounded-lg border border-primary-100">{d.strategyMemo}</p>
            </div>}
            {d.visitNotes&&<div>
              <h4 className="text-xs font-bold text-gray-700 mb-1.5 flex items-center gap-1.5"><i className="fas fa-route text-blue-500"/>방문 전략</h4>
              <p className="text-xs text-gray-600 leading-relaxed bg-blue-50 p-3 rounded-lg border border-blue-100">{d.visitNotes}</p>
            </div>}
          </div>}

          {activeSection==='treatment'&&<TreatmentSummary philosophy={d.treatmentPhilosophy} preferences={d.treatmentPreferences}/>}
          {activeSection==='research'&&<ResearchSummary researchFocus={d.researchFocus} publications={d.keyPublications} societyRoles={d.societyRoles} booksPatents={d.booksPatents}/>}
          {activeSection==='media'&&<MediaSummary media={d.mediaAppearances} sourceUrls={d.sourceUrls}/>}
          {activeSection==='strategy'&&<AIStrategy strategy={aiStrategy} isDB={true}/>}
        </div>
      </div>);
    })()}

    {/* ===== AI RESULTS ===== */}
    {data&&!loading&&source==='ai'&&<div className="space-y-4 animate-fadeInUp">
      <div className="flex items-center justify-center"><span className="inline-flex items-center gap-1.5 px-3 py-1 bg-amber-50 border border-amber-200 rounded-full"><i className="fas fa-robot text-amber-500 text-[10px]"/><span className="text-[10px] font-bold text-amber-600">AI 추정 결과</span><span className="text-[9px] text-amber-400 ml-1">정확도 제한 — DB 등록 권장</span></span></div>

      <div className="section-card"><div className="flex items-start gap-3"><div className="w-12 h-12 rounded-xl bg-gradient-to-br from-amber-300 to-orange-300 flex items-center justify-center text-amber-900 text-lg font-bold flex-shrink-0">{data.name?.slice(-1)||'?'}</div><div className="flex-1"><div className="flex items-center gap-2 flex-wrap"><h2 className="text-base font-bold text-gray-900">{data.name}</h2><span className="text-xs text-gray-400">{data.position}</span>{data.kolTier&&<span className="text-[10px] px-2 py-0.5 rounded-full bg-amber-50 text-amber-600 border border-amber-200">Tier {data.kolTier} (추정)</span>}</div><p className="text-xs text-gray-500">{data.hospital} | {data.specialty}</p>{data.specialtyTags?.length>0&&<div className="flex flex-wrap gap-1 mt-1.5">{data.specialtyTags.map((t,i)=><span key={i} className="text-[10px] px-2 py-0.5 rounded-full bg-amber-50 text-amber-600">{t} (추정)</span>)}</div>}</div></div></div>

      {data.oneLiner&&<div className="bg-gradient-to-r from-amber-600 to-orange-500 rounded-xl p-3 text-white"><p className="text-[10px] text-amber-100 mb-0.5"><i className="fas fa-bullseye mr-1"/>한 마디 요약 (추정)</p><p className="text-sm font-bold">{data.oneLiner}</p></div>}

      {(data.researchFocus||data.treatmentPhilosophy)&&<div className="section-card space-y-3">
        {data.researchFocus&&<div><p className="text-[10px] font-bold text-purple-600 mb-1"><i className="fas fa-flask mr-1"/>연구 관심사 (추정)</p><p className="text-xs text-gray-600 bg-purple-50 p-2.5 rounded-lg">{data.researchFocus}</p></div>}
        {data.treatmentPhilosophy&&<div><p className="text-[10px] font-bold text-green-600 mb-1"><i className="fas fa-stethoscope mr-1"/>치료 성향 (추정)</p><p className="text-xs text-gray-600 bg-green-50 p-2.5 rounded-lg">{data.treatmentPhilosophy}</p></div>}
      </div>}

      <AIStrategy strategy={data} isDB={false}/>

      {data.caveat&&<div className="bg-amber-50 rounded-xl p-3 border border-amber-200 text-xs text-amber-700"><i className="fas fa-exclamation-triangle mr-1"/>{data.caveat}</div>}
    </div>}

    {/* Empty */}
    {!loading&&!data&&!error&&<div className="section-card text-center py-10 animate-fadeInUp"><div className="w-14 h-14 mx-auto mb-3 rounded-xl bg-primary-50 flex items-center justify-center"><i className="fas fa-user-doctor text-xl text-primary-300"/></div><h3 className="text-base font-bold text-gray-800">KOL을 검색해보세요</h3><p className="text-xs text-gray-400 mt-1">DB 등록 KOL은 <span className="text-green-600 font-medium">진료일정·치료성향·논문·강연</span> 등 실전 정보 제공</p><p className="text-[10px] text-gray-300 mt-2">미등록 KOL은 AI 추정 결과 제공 (정확도 제한)</p></div>}
  </div>);
}

// ============================================================
// KOL DATABASE CRUD
// ============================================================
function KOLDatabase(){
  const [profiles,setProfiles]=useState([]);const [loading,setLoading]=useState(true);const [showForm,setShowForm]=useState(false);const [editId,setEditId]=useState(null);
  const emptyForm={name:'',hospital:'',department:'',position:'',specialty_tags:'',kol_tier:'C',persona:'Neutral',prescription_pattern:'Moderate',strategy_memo:'',visit_notes:'',treatment_philosophy:'',research_focus:''};
  const [form,setForm]=useState({...emptyForm});
  const load=async()=>{setLoading(true);try{const r=await fetch('/api/kol/profiles');const d=await r.json();setProfiles(d.data||[])}catch{}setLoading(false)};
  useEffect(()=>{load()},[]);
  const submit=async()=>{if(!form.name||!form.hospital||!form.department){alert('이름, 병원, 진료과 필수');return}try{const p={...form,specialty_tags:form.specialty_tags?form.specialty_tags.split(',').map(s=>s.trim()).filter(Boolean):[]};const url=editId?`/api/kol/profiles/${editId}`:'/api/kol/profiles';const r=await fetch(url,{method:editId?'PUT':'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(p)});const res=await r.json();if(res.success||res.id){setShowForm(false);setEditId(null);setForm({...emptyForm});load()}else alert(res.error)}catch(e){alert(e.message)}};
  const edit=async(id)=>{try{const r=await fetch(`/api/kol/profiles/${id}`);const res=await r.json();if(res.data){const d=res.data;const tags=d.specialty_tags?typeof d.specialty_tags==='string'?JSON.parse(d.specialty_tags):d.specialty_tags:[];setForm({name:d.name||'',hospital:d.hospital||'',department:d.department||'',position:d.position||'',specialty_tags:tags.join(', '),kol_tier:d.kol_tier||'C',persona:d.persona||'Neutral',prescription_pattern:d.prescription_pattern||'Moderate',strategy_memo:d.strategy_memo||'',visit_notes:d.visit_notes||'',treatment_philosophy:d.treatment_philosophy||'',research_focus:d.research_focus||''});setEditId(id);setShowForm(true)}}catch(e){alert(e.message)}};
  const del=async(id,name)=>{if(!confirm(`"${name}" 삭제?`))return;try{await fetch(`/api/kol/profiles/${id}`,{method:'DELETE'});load()}catch{}};
  const tc={'A':'bg-purple-100 text-purple-700','B':'bg-blue-100 text-blue-700','C':'bg-teal-100 text-teal-700','D':'bg-gray-100 text-gray-500'};
  return(<div className="space-y-5 animate-fadeInUp">
    <div className="flex items-center justify-between"><p className="text-xs text-gray-500">등록 KOL: <span className="font-bold text-primary-600">{profiles.length}명</span></p><button onClick={()=>{setShowForm(true);setEditId(null);setForm({...emptyForm})}} className="px-4 py-2.5 bg-gradient-to-r from-primary-800 to-primary-600 text-white rounded-xl text-sm font-semibold hover:shadow-lg"><i className="fas fa-plus mr-1"/>새 KOL 등록</button></div>
    {showForm&&<div className="section-card border-primary-200 animate-fadeInUp"><h3 className="font-bold text-gray-900 mb-4 flex items-center gap-2 text-sm"><i className={`fas ${editId?'fa-edit':'fa-user-plus'} text-primary-500`}/>{editId?'KOL 수정':'새 KOL 등록'}</h3><div className="grid grid-cols-1 md:grid-cols-2 gap-3">
      <div><label className="text-[11px] font-medium text-gray-600">이름 *</label><input value={form.name} onChange={e=>setForm({...form,name:e.target.value})} className="w-full mt-1 px-3 py-2 rounded-lg border border-surface-200 text-sm focus:border-primary-400 outline-none" placeholder="예: 정성진"/></div>
      <div><label className="text-[11px] font-medium text-gray-600">병원 *</label><input value={form.hospital} onChange={e=>setForm({...form,hospital:e.target.value})} className="w-full mt-1 px-3 py-2 rounded-lg border border-surface-200 text-sm focus:border-primary-400 outline-none" placeholder="예: 분당서울대학교병원"/></div>
      <div><label className="text-[11px] font-medium text-gray-600">진료과 *</label><input value={form.department} onChange={e=>setForm({...form,department:e.target.value})} className="w-full mt-1 px-3 py-2 rounded-lg border border-surface-200 text-sm focus:border-primary-400 outline-none" placeholder="예: 비뇨의학과"/></div>
      <div><label className="text-[11px] font-medium text-gray-600">직위</label><input value={form.position} onChange={e=>setForm({...form,position:e.target.value})} className="w-full mt-1 px-3 py-2 rounded-lg border border-surface-200 text-sm focus:border-primary-400 outline-none" placeholder="예: 교수"/></div>
      <div><label className="text-[11px] font-medium text-gray-600">전문분야 (쉼표 구분)</label><input value={form.specialty_tags} onChange={e=>setForm({...form,specialty_tags:e.target.value})} className="w-full mt-1 px-3 py-2 rounded-lg border border-surface-200 text-sm focus:border-primary-400 outline-none" placeholder="예: 배뇨장애, 전립선비대증"/></div>
      <div className="grid grid-cols-3 gap-2"><div><label className="text-[11px] font-medium text-gray-600">Tier</label><select value={form.kol_tier} onChange={e=>setForm({...form,kol_tier:e.target.value})} className="w-full mt-1 px-2 py-2 rounded-lg border border-surface-200 text-sm outline-none"><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option></select></div><div><label className="text-[11px] font-medium text-gray-600">Persona</label><select value={form.persona} onChange={e=>setForm({...form,persona:e.target.value})} className="w-full mt-1 px-2 py-2 rounded-lg border border-surface-200 text-sm outline-none"><option>Champion</option><option>Advocate</option><option>Supporter</option><option>Neutral</option><option>Non-Adopter</option></select></div><div><label className="text-[11px] font-medium text-gray-600">처방패턴</label><select value={form.prescription_pattern} onChange={e=>setForm({...form,prescription_pattern:e.target.value})} className="w-full mt-1 px-2 py-2 rounded-lg border border-surface-200 text-sm outline-none"><option>High Adopter</option><option>Moderate</option><option>Conservative</option></select></div></div>
      <div className="md:col-span-2"><label className="text-[11px] font-medium text-gray-600">치료 철학/성향</label><textarea value={form.treatment_philosophy} onChange={e=>setForm({...form,treatment_philosophy:e.target.value})} rows={2} className="w-full mt-1 px-3 py-2 rounded-lg border border-surface-200 text-sm outline-none resize-none" placeholder="예: 환자 삶의 질 중심, 단계적 치료 접근"/></div>
      <div className="md:col-span-2"><label className="text-[11px] font-medium text-gray-600">연구 관심사</label><textarea value={form.research_focus} onChange={e=>setForm({...form,research_focus:e.target.value})} rows={2} className="w-full mt-1 px-3 py-2 rounded-lg border border-surface-200 text-sm outline-none resize-none" placeholder="주요 연구 주제 및 관심 분야"/></div>
      <div className="md:col-span-2"><label className="text-[11px] font-medium text-gray-600">영업 전략 메모</label><textarea value={form.strategy_memo} onChange={e=>setForm({...form,strategy_memo:e.target.value})} rows={2} className="w-full mt-1 px-3 py-2 rounded-lg border border-surface-200 text-sm outline-none resize-none" placeholder="접근 전략, 주의사항 등"/></div>
      <div className="md:col-span-2"><label className="text-[11px] font-medium text-gray-600">방문 전략</label><textarea value={form.visit_notes} onChange={e=>setForm({...form,visit_notes:e.target.value})} rows={2} className="w-full mt-1 px-3 py-2 rounded-lg border border-surface-200 text-sm outline-none resize-none" placeholder="방문 시간, 준비 자료, 주의사항 등"/></div>
    </div><div className="flex gap-2 mt-4"><button onClick={submit} className="px-5 py-2 bg-primary-800 text-white rounded-lg text-sm font-semibold"><i className="fas fa-save mr-1"/>{editId?'수정 저장':'등록'}</button><button onClick={()=>{setShowForm(false);setEditId(null)}} className="px-5 py-2 bg-surface-100 text-gray-600 rounded-lg text-sm">취소</button></div></div>}
    {loading?<div className="section-card text-center py-8"><i className="fas fa-spinner fa-spin text-xl text-primary-400 mb-2"/><p className="text-sm text-gray-400">로딩 중...</p></div>:profiles.length===0?<div className="section-card text-center py-8"><i className="fas fa-database text-xl text-gray-200 mb-2"/><h3 className="font-bold text-gray-800 text-sm">등록된 KOL 없음</h3><p className="text-xs text-gray-400 mt-1">위 버튼으로 KOL을 등록하세요</p></div>:<div className="grid grid-cols-1 md:grid-cols-2 gap-3">{profiles.map(p=>{const tags=typeof p.specialty_tags==='string'?(()=>{try{return JSON.parse(p.specialty_tags)}catch{return[]}})():(p.specialty_tags||[]);return(<div key={p.id} className="section-card hover:border-primary-200 transition-all"><div className="flex items-start gap-3"><div className="w-11 h-11 rounded-xl bg-gradient-to-br from-green-500 to-cyan-400 flex items-center justify-center text-white font-bold flex-shrink-0">{p.name?.slice(-1)}</div><div className="flex-1 min-w-0"><div className="flex items-center gap-1.5 flex-wrap"><h4 className="font-bold text-gray-900 text-sm">{p.name}</h4><span className={`text-[10px] px-1.5 py-0.5 rounded-full font-bold ${tc[p.kol_tier]||tc.C}`}>Tier {p.kol_tier}</span><span className="text-[10px] px-1.5 py-0.5 rounded-full bg-green-50 text-green-600">{p.persona}</span></div><p className="text-[11px] text-gray-500 mt-0.5">{p.hospital} | {p.department}</p>{tags.length>0&&<div className="flex flex-wrap gap-1 mt-1">{tags.slice(0,3).map((t,i)=><span key={i} className="text-[9px] px-1.5 py-0.5 rounded bg-primary-50 text-primary-600">{t}</span>)}{tags.length>3&&<span className="text-[9px] text-gray-400">+{tags.length-3}</span>}</div>}</div><div className="flex gap-1 flex-shrink-0"><button onClick={()=>edit(p.id)} className="w-7 h-7 rounded bg-surface-50 flex items-center justify-center text-gray-400 hover:text-primary-600 transition-colors" title="수정"><i className="fas fa-pen text-[10px]"/></button><button onClick={()=>del(p.id,p.name)} className="w-7 h-7 rounded bg-surface-50 flex items-center justify-center text-gray-400 hover:text-red-500 transition-colors" title="삭제"><i className="fas fa-trash text-[10px]"/></button></div></div></div>)})}</div>}
  </div>);
}

// ============================================================
// P&T STRATEGY
// ============================================================
function PnTStrategy(){const[si,setSi]=useState(0);const h=ptDatabase.hospitals[si];return(<div className="space-y-5"><div className="grid grid-cols-1 md:grid-cols-2 gap-3 animate-fadeInUp">{ptDatabase.hospitals.map((ho,i)=><button key={i} onClick={()=>setSi(i)} className={`p-4 rounded-2xl border-2 text-left transition-all ${si===i?'border-primary-500 bg-primary-50/50 shadow-lg':'border-surface-200 bg-white hover:border-primary-200'}`}><div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className={`w-10 h-10 rounded-xl flex items-center justify-center ${si===i?'bg-primary-800 text-white':'bg-surface-100 text-gray-400'}`}><i className="fas fa-hospital"/></div><div><h3 className="font-bold text-gray-900 text-sm">{ho.name}</h3><p className="text-[10px] text-gray-400">{ho.committee}</p></div></div><div className="text-right"><span className={`text-sm font-bold ${ho.dday<=7?'text-red-500':'text-gray-500'}`}>D-{ho.dday}</span><p className="text-[10px] text-gray-400">{ho.nextMeeting}</p></div></div></button>)}</div>
  <div className="grid grid-cols-1 lg:grid-cols-3 gap-4"><div className="lg:col-span-2 section-card animate-fadeInUp"><h3 className="font-bold text-gray-900 mb-3 flex items-center gap-2 text-sm"><i className="fas fa-user-group text-primary-500"/>위원회 구성원</h3><div className="space-y-2">{h.members.map((m,i)=><div key={i} className="p-3 rounded-xl border border-surface-200 hover:border-primary-200 transition-all"><div className="flex items-start gap-2.5"><div className="w-8 h-8 rounded-full bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center text-white text-xs font-bold flex-shrink-0">{m.name.charAt(0)}</div><div className="flex-1"><div className="flex items-center gap-1.5 flex-wrap"><span className="font-semibold text-gray-800 text-xs">{m.name}</span><span className="text-[10px] px-1.5 py-0.5 rounded bg-surface-100 text-gray-500">{m.role}</span><span className={`text-[10px] px-1.5 py-0.5 rounded-full font-medium ${m.stance==='우호적'?'bg-green-100 text-green-600':m.stance==='부정적'?'bg-red-100 text-red-600':'bg-gray-100 text-gray-500'}`}>{m.stance}</span></div><p className="text-[10px] text-gray-500 mt-0.5"><i className="fas fa-lightbulb text-yellow-500 mr-1"/>{m.note}</p></div></div></div>)}</div></div>
  <div className="space-y-4"><div className="section-card animate-fadeInUp"><h3 className="font-bold text-gray-900 mb-3 text-sm"><i className="fas fa-folder-open text-primary-500 mr-1"/>준비 서류</h3><div className="space-y-2">{h.documents.map((d,i)=><div key={i} className="flex items-center gap-2 p-2 rounded-lg border border-surface-200"><i className={`fas ${d.icon} text-primary-400 text-sm`}/><span className="flex-1 text-xs text-gray-700">{d.name}</span><span className={`text-[10px] px-1.5 py-0.5 rounded-full font-medium ${d.status==='완료'?'bg-green-100 text-green-600':'bg-blue-100 text-blue-600'}`}>{d.status}</span></div>)}</div></div>
  <div className={`rounded-2xl p-4 text-center ${h.dday<=7?'bg-gradient-to-br from-red-500 to-red-600 text-white':'bg-gradient-to-br from-primary-700 to-primary-800 text-white'}`}><p className="text-xs font-medium opacity-80">회의까지</p><p className="text-3xl font-black mt-1">D-{h.dday}</p><p className="text-xs mt-1 opacity-80">{h.nextMeeting}</p></div></div></div>
  <div className="section-card animate-fadeInUp"><h3 className="font-bold text-gray-900 mb-3 text-sm"><i className="fas fa-list-check text-primary-500 mr-1"/>액션 플랜</h3><div className="grid grid-cols-1 md:grid-cols-2 gap-2">{h.strategy.map((s,i)=><div key={i} className="flex items-start gap-2.5 p-3 rounded-xl bg-surface-50 border border-surface-200"><div className="w-5 h-5 rounded bg-primary-800 text-white flex items-center justify-center text-[10px] font-bold flex-shrink-0">{i+1}</div><p className="text-xs text-gray-700">{s}</p></div>)}</div></div></div>);}

// ============================================================
// PRICING
// ============================================================
function PricingPage(){const pl=[{name:'Starter',price:'49,000',period:'/월',desc:'소규모 팀',features:['월 50회 KOL 분석','팀원 3명','P&T 플래너','기본 대시보드'],hl:false,cta:'무료 체험'},{name:'Professional',price:'149,000',period:'/월',desc:'영업팀 추천',features:['월 500회 KOL 분석','팀원 15명','P&T 무제한','고급 리포트','PubMed 연동','우선 지원'],hl:true,cta:'14일 무료 체험'},{name:'Enterprise',price:'문의',period:'',desc:'대형 제약사',features:['무제한 분석','무제한 팀원','맞춤 AI 모델','SSO','전용 API','SLA 99.9%'],hl:false,cta:'문의'}];
return(<div className="space-y-6 animate-fadeInUp"><div className="text-center"><h2 className="text-2xl font-bold text-gray-900">합리적인 가격</h2><p className="text-sm text-gray-500 mt-2">팀 생산성을 높이세요</p></div><div className="grid grid-cols-1 md:grid-cols-3 gap-5 max-w-5xl mx-auto">{pl.map((p,i)=><div key={i} className={`rounded-2xl p-5 transition-all ${p.hl?'bg-gradient-to-b from-primary-800 to-primary-900 text-white shadow-2xl md:scale-105 border-2 border-primary-400/30':'bg-white border border-surface-200 hover:shadow-lg'}`}>{p.hl&&<div className="text-center mb-3"><span className="text-[10px] font-bold px-3 py-1 rounded-full bg-yellow-400 text-primary-900">추천</span></div>}<h3 className={`text-lg font-bold ${p.hl?'':'text-gray-900'}`}>{p.name}</h3><p className={`text-xs mt-1 ${p.hl?'text-blue-200':'text-gray-400'}`}>{p.desc}</p><div className="mt-4 mb-5"><span className={`text-2xl font-black ${p.hl?'':'text-gray-900'}`}>{p.price.startsWith('문의')?'':'₩'}{p.price}</span><span className={`text-sm ${p.hl?'text-blue-200':'text-gray-400'}`}>{p.period}</span></div><ul className="space-y-2 mb-5">{p.features.map((f,j)=><li key={j} className={`flex items-center gap-2 text-xs ${p.hl?'text-blue-100':'text-gray-600'}`}><i className={`fas fa-check text-xs ${p.hl?'text-green-300':'text-green-500'}`}/>{f}</li>)}</ul><button className={`w-full py-2.5 rounded-xl font-semibold text-sm ${p.hl?'bg-white text-primary-800':'bg-primary-800 text-white hover:bg-primary-700'}`}>{p.cta}</button></div>)}</div></div>);}

// ============================================================
// APP
// ============================================================
function App(){const[page,setPage]=useState('dashboard');const[sidebarOpen,setSidebarOpen]=useState(false);const[kolQ,setKolQ]=useState('');
  const navKOL=(q)=>{setKolQ(q);setPage('kol')};
  const render=()=>{switch(page){case 'dashboard':return <Dashboard onNavigateToKOL={navKOL}/>;case 'kol':return <KOLIntelligence key={kolQ} initialQuery={kolQ}/>;case 'koldb':return <KOLDatabase/>;case 'pnt':return <PnTStrategy/>;case 'pricing':return <PricingPage/>;default:return <Dashboard onNavigateToKOL={navKOL}/>}};
  return(<div className="flex min-h-screen bg-surface-50"><Sidebar currentPage={page} setCurrentPage={p=>{setPage(p);setKolQ('')}} sidebarOpen={sidebarOpen} setSidebarOpen={setSidebarOpen}/><main className="flex-1 lg:ml-64 min-w-0"><Header currentPage={page} setSidebarOpen={setSidebarOpen}/><div className="p-4 lg:p-6">{render()}</div></main></div>);
}
const root=ReactDOM.createRoot(document.getElementById('root'));root.render(<App/>);
</script>
</body>
</html>
